<!DOCTYPE html>
<html>
<head>
    <title>星驰笔记本</title>
	<link rel="stylesheet" href="../../layui/css/layui.css" />
	<script src="../../js/jquery.min.js"></script>
	<script src="../../layui/layui.js"></script>
    <style type="text/css">
		html,body{
			height: 97%;
			width: 100%;
			overflow-y: scroll;
			overflow-x: scroll;
		}
    </style>
	<script type="text/javascript">
		function reset(){
			$("#title").val("");
			layedit.setContent(index, "");
		}
		function doSubmit(){
			var title = $("#title").val();
			var htmlContent = layedit.getContent(index);
			if($.trim(title).length == 0){
				layer.tips('标题不能为空', 'title', {
					tips: 1
				});
				return;
			}
			var data = {
				"title": title,
				"content": htmlContent,
				"type": 1
			};
			var url;
			if(getQueryString("cmd") == "detail"){
				data.id = getQueryString("id");
				url = "/note/api/v1/note/modify";
			} else if (getQueryString("cmd") == "new"){
				data.dirId = getQueryString("id");
				url = "/note/api/v1/note/create";
			}
			$.ajax({
				  type: 'POST',
				  url: url,
				  data: JSON.stringify(data),
				  success: function(){
					layer.msg("保存成功.");
				  },
				  contentType: "application/json;charset=utf-8"
			});
		}
		function getQueryString(name){
			 var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			 var r = window.location.search.substr(1).match(reg);
			 if(r!=null)return  unescape(r[2]); return null;
		}
	</script>
	
</head>
<body>
  <div class="layui-form-item">
	<label class="layui-form-label">标题</label>
	<div class="layui-input-block">
	  <input type="text" id="title" required style="width: 450px; margin-top: 10px;" lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
	</div>
  </div>
  <div class="layui-form-item layui-form-text">
	<label class="layui-form-label">内容</label>
	<div class="layui-input-block" style="width: 70%;">
	  <textarea id="editor" style="display: none;" autofocus></textarea>
	  <script type="text/javascript">
		var layedit;
		var index;
		layui.use(['form', 'layedit', 'upload'], function(){
			 var form = layui.form();
			 layedit = layui.layedit;
			 layui.upload();
			 layedit.set({
			  uploadImage: {
				url: '/note/api/v1/upload/img',
				type: 'post'
			  }
			});
			 index = layedit.build('editor', {
				 height: 600
			 });
			 var cmd = getQueryString("cmd");
			 var id = getQueryString("id");
			 if(cmd == "detail"){
				var noteId = id;
				$.ajax({
					  type: 'GET',
					  url: "/note/api/v1/note/get/" + noteId,
					  success: function(data){
						$("#title").val(data.title);
						layedit.setContent(index, data.content);
					  },
					  contentType: "application/json;charset=utf-8"
				});
			 }
		});
	</script>
	</div>
  </div>
   <div class="layui-form-item">
	<label class="layui-form-label">附件</label>
	<input lay-type="file" name="attach" class="layui-upload-file">
   </div>
  <div class="layui-form-item">
	<div class="layui-input-block">
	  <button onclick="doSubmit()" class="layui-btn">保存</button>
	  <button onclick="reset()" type="reset" class="layui-btn layui-btn-primary">重置</button>
	</div>
  </div>
</html>