<!DOCTYPE html>
<html>
<head>
    <title>星驰笔记本</title>
	<link rel="stylesheet" href="../../layui/css/layui.css" />
	<link rel="stylesheet" type="text/css" href="../../simditor/styles/simditor.css" />
	<script type="text/javascript" src="../../simditor/scripts/jquery.min.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/module.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/hotkeys.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/uploader.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/simditor.js"></script>
	<script src="../../js/jquery.min.js"></script>
	<script src="../../layui/layui.js"></script>
    <style type="text/css">
		html,body{
			height: 98%;
			width: 100%;
			overflow-y: scroll;
			overflow-x: scroll;
		}
    </style>
	<script type="text/javascript">
		var form;
		var layedit;
		layui.use(['form', 'layedit', 'upload'], function(){
		  form = layui.form();
		  layui.upload({
			  url: ''
			  ,ext: 'jpg|png|gif' //那么，就只会支持这三种格式的上传。注意是用|分割。
			  ,success: function(res, input){}
			});        
		});
		var cmd = getQueryString("cmd");
		var id = getQueryString("id");
		if(cmd == "detail"){
			var noteId = id;
			$.ajax({
				  type: 'GET',
				  url: "http://127.0.0.1:8080/note/api/v1/note/get/" + noteId,
				  success: function(data){
					$("#title").val(data.title);
					editor.setValue(data.content);
				  },
				  contentType: "application/json;charset=utf-8"
			});
		}
		function doSubmit(){
			var title = $("#title").val();
			var htmlContent = editor.getValue();
			var data = {
				"title": title,
				"content": htmlContent,
				"type": 1
			};
			var url;
			if(getQueryString("cmd") == "detail"){
				data.id = getQueryString("id");
				url = "http://127.0.0.1:8080/note/api/v1/note/modify";
			} else if (getQueryString("cmd") == "new"){
				data.dirId = getQueryString("id");
				url = "http://127.0.0.1:8080/note/api/v1/note/create";
			}
			$.ajax({
				  type: 'POST',
				  url: url,
				  data: JSON.stringify(data),
				  success: function(){
					alert("保存成功.");
				  },
				  contentType: "application/json;charset=utf-8"
			});
			
		}
		function getQueryString(name){
			 var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			 var r = window.location.search.substr(1).match(reg);
			 if(r!=null)return  unescape(r[2]); return null;
		}
		
	</script>
	
</head>
<body>
	<form class="layui-form" action="">
	  <div class="layui-form-item">
		<label class="layui-form-label">标题</label>
		<div class="layui-input-block">
		  <input type="text" id="title" required  lay-verify="required" placeholder="请输入标题" autocomplete="off" class="layui-input">
		</div>
	  </div>
	  <div class="layui-form-item layui-form-text">
		<label class="layui-form-label">内容</label>
		<div class="layui-input-block">
		  <textarea id="editor" placeholder="请输入..." autofocus></textarea>
		  <script type="text/javascript">
			var editor = new Simditor({
			  textarea: $('#editor'),
			  placeholder: '',
			  defaultImage: '../../simditor/images/image.png',
			  params: {},
			  upload: true,
			  tabIndent: true,
			  toolbar: true,
			  toolbarFloat: true,
			  toolbarFloatOffset: 0,
			  toolbarHidden: false,
			  pasteImage: true,
			  cleanPaste: true
			});
		</script>
		</div>
	  </div>
	   <div class="layui-form-item">
		<label class="layui-form-label">附件</label>
		<input type="file" name="attach" class="layui-upload-file">
	   </div>
	  <div class="layui-form-item">
		<div class="layui-input-block">
		  <button onclick="doSubmit()" class="layui-btn" lay-submit lay-filter="formDemo">保存</button>
		  <button type="reset" class="layui-btn layui-btn-primary">重置</button>
		</div>
	  </div>
	</form>
</html>