<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>星驰笔记本</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script type="text/javascript" charset="utf-8" src="../../ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../ueditor.all.min.js"> </script>
    <script type="text/javascript" charset="utf-8" src="../../lang/zh-cn/zh-cn.js"></script>
	<script src="../../js/jquery.min.js"></script>
    <style type="text/css">
		html,body{
			height: 100%;
			width: 100%;
			overflow-y: scroll;
			overflow-x: scroll;
		}
		#title{
			width:50%;
		}
        #content{
            width:90%;
			height: 100%;
        }
		td{
			text-align: left;
			vertical-align: top;
		}
		button{
			background: #398DEE;
			width: 60px;
			height: 25px;
			color: white;
			margin-top: 10px;
		}
    </style>
	<script type="text/javascript">
		var ue = new UE.ui.Editor({
			initialFrameWidth:1000,//设置编辑器宽度
			initialFrameHeight:700,//设置编辑器高度
			scaleEnabled:true
		});  
        ue.render("content"); 
		ue.addListener("ready", function () {
			var cmd = getQueryString("cmd");
			var id = getQueryString("id");
			if(cmd == "detail"){
				var noteId = id;
				$.ajax({
					  type: 'GET',
					  url: "http://127.0.0.1:8080/note/api/v1/note/get/" + noteId,
					  success: function(data){
						$("#title").val(data.title);
						ue.setContent(data.content);
					  },
					  contentType: "application/json;charset=utf-8"
				});
			}
			
		});
		function doSubmit(){
			var title = $("#title").val();
			var htmlContent = UE.getEditor('content').getContent();
			var data = {
				"title": title,
				"content": htmlContent,
				"type": 1
			};
			var url;
			if(getQueryString("cmd") == "detail"){
				data.id = getQueryString("id");
				url = "http://127.0.0.1:8080/note/api/v1/note/modify";
			} else if (getQueryString("cmd") == "new"){
				data.dirId = getQueryString("id");
				url = "http://127.0.0.1:8080/note/api/v1/note/create";
			}
			$.ajax({
				  type: 'POST',
				  url: url,
				  data: JSON.stringify(data),
				  success: function(){
					alert("保存成功.");
				  },
				  contentType: "application/json;charset=utf-8"
			});
			
		}
		function getQueryString(name){
			 var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			 var r = window.location.search.substr(1).match(reg);
			 if(r!=null)return  unescape(r[2]); return null;
		}
	</script>
	
</head>
<body>
<input type="hidden" id="noteId" value=""/>	<table cellspacing="10">
		<tr height="20px">
			<td width="5%"><label for="title">标题：</label></td>
			<td width="90%"><input id="title" name="title" type="text"/><br/></td>
		</tr>
		<tr height="800px">
			<td><label for="content">内容：</label></td>
			<td><div id="content"></div></td>
		</tr>
		<tr>
			<td></td>
			<td><button onclick="doSubmit()">保存</button></td>
		</tr>
	</table>
</body>
</html>