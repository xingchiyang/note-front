<!DOCTYPE html>
<html>
<head>
    <title>星驰笔记本</title>
	<link rel="stylesheet" type="text/css" href="../../simditor/styles/simditor.css" />

	<script type="text/javascript" src="../../simditor/scripts/jquery.min.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/module.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/hotkeys.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/uploader.js"></script>
	<script type="text/javascript" src="../../simditor/scripts/simditor.js"></script>
    <style type="text/css">
		html,body{
			height: 100%;
			width: 100%;
			overflow-y: scroll;
			overflow-x: scroll;
		}
		#title{
			width:50%;
		}
        #editor{
            width:100%;
			height: 100%;
        }
		table{
			width:100%;
			height: 92%;
		}
		td{
			text-align: left;
			vertical-align: top;
		}
		button{
			background: #398DEE;
			width: 60px;
			height: 25px;
			color: white;
			margin-top: 10px;
		}
    </style>
	<script type="text/javascript">
		var cmd = getQueryString("cmd");
		var id = getQueryString("id");
		if(cmd == "detail"){
			var noteId = id;
			$.ajax({
				  type: 'GET',
				  url: "http://127.0.0.1:8080/note/api/v1/note/get/" + noteId,
				  success: function(data){
					$("#title").val(data.title);
					editor.setValue(data.content);
				  },
				  contentType: "application/json;charset=utf-8"
			});
		}
		function doSubmit(){
			var title = $("#title").val();
			debugger;
			var htmlContent = editor.getValue();
			var data = {
				"title": title,
				"content": htmlContent,
				"type": 1
			};
			var url;
			if(getQueryString("cmd") == "detail"){
				data.id = getQueryString("id");
				url = "http://127.0.0.1:8080/note/api/v1/note/modify";
			} else if (getQueryString("cmd") == "new"){
				data.dirId = getQueryString("id");
				url = "http://127.0.0.1:8080/note/api/v1/note/create";
			}
			$.ajax({
				  type: 'POST',
				  url: url,
				  data: JSON.stringify(data),
				  success: function(){
					alert("保存成功.");
				  },
				  contentType: "application/json;charset=utf-8"
			});
			
		}
		function getQueryString(name){
			 var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			 var r = window.location.search.substr(1).match(reg);
			 if(r!=null)return  unescape(r[2]); return null;
		}
	</script>
	
</head>
<body>
	<table>
		<tr height="5%">
			<td width="10%"><label for="title">标题：</label></td>
			<td width="90%"><input id="title" name="title" type="text"/><br/></td>
		</tr>
		<tr height="90%">
			<td><label for="editor">内容：</label></td>
			<td><textarea id="editor" placeholder="请输入..." autofocus></textarea></td>
			<script type="text/javascript">
			var editor = new Simditor({
			  textarea: $('#editor'),
			  placeholder: '',
			  defaultImage: '../../simditor/images/image.png',
			  params: {},
			  upload: true,
			  tabIndent: true,
			  toolbar: true,
			  toolbarFloat: true,
			  toolbarFloatOffset: 0,
			  toolbarHidden: false,
			  pasteImage: true,
			  cleanPaste: true
			});
		</script>
		</tr>
		<tr height="5%">
			<td></td>
			<td><button onclick="doSubmit()">保存</button></td>
		</tr>
	</table>
</body>
</html>